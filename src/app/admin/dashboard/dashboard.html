<div class="admin-layout">
  <aside class="sidebar" [class.collapsed]="sidebarCollapsed">
    <div class="sidebar-header">
      <img src="assets/logo-pecuadex.svg" alt="Pecuadex" class="logo" />
      <button class="toggle-btn" (click)="toggleSidebar()">
        <i class="fas fa-bars"></i>
      </button>
    </div>

    <nav class="sidebar-nav">
      <ul>
        <li [class.active]="activeSection === 'dashboard'">
          <a (click)="setActiveSection('dashboard')">
            <i class="fas fa-tachometer-alt"></i>
            <span>Dashboard</span>
          </a>
        </li>
        <li [class.active]="activeSection === 'productos'">
          <a (click)="setActiveSection('productos')">
            <i class="fas fa-box"></i>
            <span>Productos</span>
          </a>
        </li>
        <li [class.active]="activeSection === 'inventario'">
          <a (click)="setActiveSection('inventario')">
            <i class="fas fa-warehouse"></i>
            <span>Inventario</span>
          </a>
        </li>
        <li [class.active]="activeSection === 'ventas'">
          <a (click)="setActiveSection('ventas')">
            <i class="fas fa-shopping-cart"></i>
            <span>Ventas</span>
          </a>
        </li>
        <li [class.active]="activeSection === 'compras'">
          <a (click)="setActiveSection('compras')">
            <i class="fas fa-truck"></i>
            <span>Compras</span>
          </a>
        </li>
        <li [class.active]="activeSection === 'proveedores'">
          <a (click)="setActiveSection('proveedores')">
            <i class="fas fa-handshake"></i>
            <span>Proveedores</span>
          </a>
        </li>
        <li [class.active]="activeSection === 'usuarios'">
          <a (click)="setActiveSection('usuarios')">
            <i class="fas fa-users"></i>
            <span>Usuarios</span>
          </a>
        </li>
        <li [class.active]="activeSection === 'cotizaciones'">
          <a (click)="setActiveSection('cotizaciones')">
            <i class="fas fa-file-invoice-dollar"></i>
            <span>Cotizaciones</span>
          </a>
        </li>
        <li [class.active]="activeSection === 'reportes'">
          <a (click)="setActiveSection('reportes')">
            <i class="fas fa-chart-bar"></i>
            <span>Reportes</span>
          </a>
        </li>
      </ul>
    </nav>

    <div class="sidebar-footer">
      <div class="user-info">
        <img src="assets/avatar-default.png" alt="User" class="avatar" />
        <div class="user-details" *ngIf="currentUser">
          <span class="name">{{ currentUser.fullName }}</span>
          <span class="role">Administrador</span>
        </div>
      </div>
      <button class="logout-btn" (click)="logout()">
        <i class="fas fa-sign-out-alt"></i>
      </button>
    </div>
  </aside>

  <main class="main-content">
    <header class="admin-header">
      <div class="header-left">
        <h1>{{ getSectionTitle() }}</h1>
        <nav class="breadcrumb">
          <a routerLink="/admin">Admin</a>
          <span>/</span>
          <span>{{ getSectionTitle() }}</span>
        </nav>
      </div>

      <div class="header-right">
        <button class="notification-btn">
          <i class="fas fa-bell"></i>
          <span class="badge">3</span>
        </button>

        <button class="settings-btn">
          <i class="fas fa-cog"></i>
        </button>
      </div>
    </header>

    <section *ngIf="activeSection === 'dashboard'" class="dashboard-section">
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon bg-primary">
            <i class="fas fa-dollar-sign"></i>
          </div>
          <div class="stat-content">
            <h3>${{ stats.totalVentas | number:'1.2-2' }}</h3>
            <p>Ventas Totales</p>
            <span class="trend up">
              <i class="fas fa-arrow-up"></i> 12.5%
            </span>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon bg-success">
            <i class="fas fa-users"></i>
          </div>
          <div class="stat-content">
            <h3>{{ stats.clientesActivos }}</h3>
            <p>Clientes Activos</p>
            <span class="trend up"> <i class="fas fa-arrow-up"></i> 8.3% </span>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon bg-warning">
            <i class="fas fa-satellite-dish"></i>
          </div>
          <div class="stat-content">
            <h3>{{ stats.dispositivosActivos }}</h3>
            <p>Dispositivos Activos</p>
            <span class="trend up">
              <i class="fas fa-arrow-up"></i> 15.7%
            </span>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon bg-info">
            <i class="fas fa-box"></i>
          </div>
          <div class="stat-content">
            <h3>{{ stats.productosStock }}</h3>
            <p>Productos en Stock</p>
            <span class="trend down">
              <i class="fas fa-arrow-down"></i> 3.2%
            </span>
          </div>
        </div>
      </div>

      <div class="charts-row">
        <div class="chart-card">
          <div class="chart-header">
            <h3>Ventas Mensuales</h3>
            <select class="form-select form-select-sm">
              <option>Últimos 6 meses</option>
              <option>Último año</option>
              <option>Todo</option>
            </select>
          </div>
          <canvas id="salesChart"></canvas>
        </div>

        <div class="chart-card">
          <div class="chart-header">
            <h3>Distribución de Productos</h3>
          </div>
          <canvas id="productsChart"></canvas>
        </div>
      </div>

      <div class="activity-card">
        <div class="card-header">
          <h3>Actividad Reciente</h3>
          <button class="btn btn-sm btn-outline-primary">Ver Todo</button>
        </div>
        <div class="activity-list">
          <div class="activity-item" *ngFor="let activity of recentActivities">
            <div class="activity-icon" [ngClass]="'bg-' + activity.type">
              <i [class]="activity.icon"></i>
            </div>
            <div class="activity-content">
              <p>{{ activity.description }}</p>
              <small>{{ activity.time }}</small>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section *ngIf="activeSection === 'productos'" class="products-section">
      <div class="section-header">
        <h2>Gestión de Productos</h2>
        <button class="btn btn-primary" (click)="openProductModal()">
          <i class="fas fa-plus"></i> Nuevo Producto
        </button>
      </div>

      <div class="table-card">
        <div class="table-header">
          <input
            type="text"
            class="form-control search-input"
            placeholder="Buscar productos..."
            [(ngModel)]="searchTerm"
          />
          <div class="table-actions">
            <button class="btn btn-sm btn-outline-secondary">
              <i class="fas fa-filter"></i> Filtros
            </button>
            <button class="btn btn-sm btn-outline-secondary">
              <i class="fas fa-download"></i> Exportar
            </button>
          </div>
        </div>

        <table class="table table-modern">
          <thead>
            <tr>
              <th>ID</th>
              <th>Imagen</th>
              <th>Nombre</th>
              <th>Descripción</th>
              <th>Precio</th>
              <th>Stock</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let producto of productos">
              <td>#{{ producto.id }}</td>
              <td>
                <img
                  [src]="producto.imagen"
                  [alt]="producto.nombre"
                  class="product-thumb"
                />
              </td>
              <td>{{ producto.nombre }}</td>
              <td>{{ producto.descripcion | slice:0:50 }}...</td>
              <td>${{ producto.precioSugerido | number:'1.2-2' }}</td>
              <td>
                <span class="badge" [ngClass]="getStockClass(producto.stock)">
                  {{ producto.stock }} unidades
                </span>
              </td>
              <td>
                <span class="badge bg-success">Activo</span>
              </td>
              <td>
                <div class="action-buttons">
                  <button class="btn btn-sm btn-info" title="Ver">
                    <i class="fas fa-eye"></i>
                  </button>
                  <button class="btn btn-sm btn-warning" title="Editar">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button class="btn btn-sm btn-danger" title="Eliminar">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>

        <div class="table-footer">
          <div class="pagination-info">
            Mostrando 1-10 de {{ productos.length }} productos
          </div>
          <nav>
            <ul class="pagination">
              <li class="page-item disabled">
                <a class="page-link">Anterior</a>
              </li>
              <li class="page-item active">
                <a class="page-link">1</a>
              </li>
              <li class="page-item">
                <a class="page-link">2</a>
              </li>
              <li class="page-item">
                <a class="page-link">3</a>
              </li>
              <li class="page-item">
                <a class="page-link">Siguiente</a>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </section>

    <section *ngIf="activeSection === 'ventas'" class="sales-section">
      <div class="section-header">
        <h2>Gestión de Ventas</h2>
        <button class="btn btn-primary">
          <i class="fas fa-plus"></i> Nueva Venta
        </button>
      </div>

      <div class="sales-summary">
        <div class="summary-card">
          <h4>Ventas del Mes</h4>
          <p class="amount">${{ stats.ventasMes | number:'1.2-2' }}</p>
          <small class="text-success">+15% vs mes anterior</small>
        </div>
        <div class="summary-card">
          <h4>Órdenes Pendientes</h4>
          <p class="amount">12</p>
          <small class="text-warning">Requieren atención</small>
        </div>
        <div class="summary-card">
          <h4>Clientes Nuevos</h4>
          <p class="amount">8</p>
          <small class="text-info">Este mes</small>
        </div>
      </div>

      <div class="table-card">
        <table class="table table-modern">
          <thead>
            <tr>
              <th>ID Venta</th>
              <th>Cliente</th>
              <th>Fecha</th>
              <th>Productos</th>
              <th>Total</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let venta of ventas">
              <td>#{{ venta.id }}</td>
              <td>{{ venta.cliente }}</td>
              <td>{{ venta.fecha | date:'short' }}</td>
              <td>{{ venta.items }} items</td>
              <td>${{ venta.total | number:'1.2-2' }}</td>
              <td>
                <span class="badge" [ngClass]="getStatusClass(venta.estado)">
                  {{ venta.estado }}
                </span>
              </td>
              <td>
                <div class="action-buttons">
                  <button class="btn btn-sm btn-info" title="Ver Detalles">
                    <i class="fas fa-eye"></i>
                  </button>
                  <button
                    class="btn btn-sm btn-success"
                    title="Generar Factura"
                  >
                    <i class="fas fa-file-invoice"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section *ngIf="activeSection === 'usuarios'" class="users-section">
      <div class="section-header">
        <h2>Gestión de Usuarios</h2>
        <button class="btn btn-primary">
          <i class="fas fa-user-plus"></i> Nuevo Usuario
        </button>
      </div>

      <div class="users-filters">
        <div class="filter-group">
          <label>Rol:</label>
          <select class="form-select">
            <option>Todos</option>
            <option>Administradores</option>
            <option>Clientes</option>
            <option>Empleados</option>
          </select>
        </div>
        <div class="filter-group">
          <label>Estado:</label>
          <select class="form-select">
            <option>Todos</option>
            <option>Activos</option>
            <option>Inactivos</option>
            <option>Suspendidos</option>
          </select>
        </div>
      </div>
    </section>
  </main>
</div>

<div class="modal" *ngIf="showProductModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Nuevo Producto</h5>
        <button class="btn-close" (click)="closeProductModal()"></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="productForm">
          <div class="mb-3">
            <label class="form-label">Nombre del Producto</label>
            <input type="text" class="form-control" formControlName="nombre" />
          </div>
          <div class="mb-3">
            <label class="form-label">Descripción</label>
            <textarea
              class="form-control"
              rows="3"
              formControlName="descripcion"
            ></textarea>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Precio Sugerido</label>
              <input
                type="number"
                class="form-control"
                formControlName="precioSugerido"
              />
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Stock Inicial</label>
              <input
                type="number"
                class="form-control"
                formControlName="stock"
              />
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">Imagen del Producto</label>
            <input
              type="file"
              class="form-control"
              (change)="onImageSelected($event)"
            />
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeProductModal()">
          Cancelar
        </button>
        <button class="btn btn-primary" (click)="saveProduct()">
          Guardar Producto
        </button>
      </div>
    </div>
  </div>
</div>
