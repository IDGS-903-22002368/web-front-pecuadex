<div class="dashboard-container">
  <!-- Header -->
  <div class="dashboard-header">
    <div class="header-content">
      <h1 class="dashboard-title">
        <i class="icon-dashboard"></i>
        Dashboard Administrativo
      </h1>
      <div class="header-actions">
        <button
          class="btn btn-primary"
          (click)="refreshData()"
          [disabled]="loading"
        >
          <i class="icon-refresh"></i>
          Actualizar
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Cargando información del dashboard...</p>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!loading" class="dashboard-content">
    <!-- Stats Cards -->
    <div class="stats-grid">
      <div class="stat-card primary">
        <div class="stat-icon">
          <i class="icon-box"></i>
        </div>
        <div class="stat-content">
          <h3 class="stat-number">{{ stats.totalProductos }}</h3>
          <p class="stat-label">Productos</p>
        </div>
      </div>

      <div class="stat-card success">
        <div class="stat-icon">
          <i class="icon-trending-up"></i>
        </div>
        <div class="stat-content">
          <h3 class="stat-number">{{ stats.totalVentas }}</h3>
          <p class="stat-label">Ventas Totales</p>
          <small class="stat-extra">{{ stats.ventasHoy }} hoy</small>
        </div>
      </div>

      <div class="stat-card info">
        <div class="stat-icon">
          <i class="icon-shopping-cart"></i>
        </div>
        <div class="stat-content">
          <h3 class="stat-number">{{ stats.totalCompras }}</h3>
          <p class="stat-label">Compras</p>
          <small class="stat-extra">{{ stats.comprasHoy }} hoy</small>
        </div>
      </div>

      <div class="stat-card warning">
        <div class="stat-icon">
          <i class="icon-users"></i>
        </div>
        <div class="stat-content">
          <h3 class="stat-number">{{ stats.totalProveedores }}</h3>
          <p class="stat-label">Proveedores</p>
        </div>
      </div>

      <div class="stat-card secondary">
        <div class="stat-icon">
          <i class="icon-layers"></i>
        </div>
        <div class="stat-content">
          <h3 class="stat-number">{{ stats.totalPiezas }}</h3>
          <p class="stat-label">Piezas/Materias Primas</p>
        </div>
      </div>

      <div class="stat-card purple">
        <div class="stat-icon">
          <i class="icon-message-circle"></i>
        </div>
        <div class="stat-content">
          <h3 class="stat-number">{{ stats.totalComentarios }}</h3>
          <p class="stat-label">Comentarios</p>
        </div>
      </div>

      <div class="stat-card teal">
        <div class="stat-icon">
          <i class="icon-file-text"></i>
        </div>
        <div class="stat-content">
          <h3 class="stat-number">{{ stats.totalCotizaciones }}</h3>
          <p class="stat-label">Cotizaciones</p>
        </div>
      </div>

      <div class="stat-card dark">
        <div class="stat-icon">
          <i class="icon-user"></i>
        </div>
        <div class="stat-content">
          <h3 class="stat-number">{{ stats.totalUsuarios }}</h3>
          <p class="stat-label">Usuarios</p>
        </div>
      </div>
    </div>

    <!-- Financial Overview -->
    <div class="financial-overview">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Resumen Financiero</h3>
        </div>
        <div class="card-body">
          <div class="financial-grid">
            <div class="financial-item income">
              <i class="icon-dollar-sign"></i>
              <div class="financial-content">
                <h4>{{ formatCurrency(stats.ingresosTotales) }}</h4>
                <p>Ingresos Totales</p>
              </div>
            </div>
            <div class="financial-item expense">
              <i class="icon-trending-down"></i>
              <div class="financial-content">
                <h4>{{ formatCurrency(stats.gastosTotales) }}</h4>
                <p>Gastos Totales</p>
              </div>
            </div>
            <div
              class="financial-item profit"
              [class.negative]="getUtilidad() < 0"
            >
              <i class="icon-trending-up"></i>
              <div class="financial-content">
                <h4>{{ formatCurrency(getUtilidad()) }}</h4>
                <p>Utilidad</p>
                <small class="margin"
                  >{{ getMargenUtilidad() | number:'1.1-1' }}% margen</small
                >
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Charts Row -->
    <div class="charts-row">
      <!-- Ventas por Mes -->
      <div class="card chart-card">
        <div class="card-header">
          <h3 class="card-title">Ventas Últimos 6 Meses</h3>
        </div>
        <div class="card-body">
          <div class="simple-chart">
            <div class="chart-bars">
              <div
                *ngFor="let item of ventasPorMes"
                class="chart-bar"
                [style.height.%]="(item.ventas / getMaxVentas()) * 100"
                [title]="item.mes + ': ' + item.ventas + ' ventas - ' + formatCurrency(item.ingresos)"
              >
                <div class="bar-value">{{ item.ventas }}</div>
              </div>
            </div>
            <div class="chart-labels">
              <span *ngFor="let item of ventasPorMes" class="chart-label"
                >{{ item.mes }}</span
              >
            </div>
          </div>
        </div>
      </div>

      <!-- Compras por Mes -->
      <div class="card chart-card">
        <div class="card-header">
          <h3 class="card-title">Compras Últimos 6 Meses</h3>
        </div>
        <div class="card-body">
          <div class="simple-chart">
            <div class="chart-bars compras">
              <div
                *ngFor="let item of comprasPorMes"
                class="chart-bar"
                [style.height.%]="(item.compras / getMaxCompras()) * 100"
                [title]="item.mes + ': ' + item.compras + ' compras - ' + formatCurrency(item.gastos)"
              >
                <div class="bar-value">{{ item.compras }}</div>
              </div>
            </div>
            <div class="chart-labels">
              <span *ngFor="let item of comprasPorMes" class="chart-label"
                >{{ item.mes }}</span
              >
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Data Tables Row -->
    <div class="tables-row">
      <!-- Ventas Recientes -->
      <div class="card table-card">
        <div class="card-header">
          <h3 class="card-title">Ventas Recientes</h3>
        </div>
        <div class="card-body">
          <div
            class="table-container"
            *ngIf="ventasRecientes.length > 0; else noVentas"
          >
            <table class="data-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Usuario</th>
                  <th>Fecha</th>
                  <th>Total</th>
                  <th>Estado</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let venta of ventasRecientes">
                  <td class="font-bold">#{{ venta.id }}</td>
                  <td>{{ venta.usuario }}</td>
                  <td>{{ venta.fecha | date:'dd/MM/yyyy HH:mm' }}</td>
                  <td class="amount">{{ formatCurrency(venta.total) }}</td>
                  <td>
                    <span class="status-badge success">{{ venta.estado }}</span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <ng-template #noVentas>
            <div class="empty-state">
              <i class="icon-shopping-bag"></i>
              <p>No hay ventas recientes</p>
            </div>
          </ng-template>
        </div>
      </div>

      <!-- Productos Más Vendidos -->
      <div class="card table-card">
        <div class="card-header">
          <h3 class="card-title">Productos Más Vendidos</h3>
        </div>
        <div class="card-body">
          <div
            class="table-container"
            *ngIf="productosPopulares.length > 0; else noProductos"
          >
            <table class="data-table">
              <thead>
                <tr>
                  <th>Producto</th>
                  <th>Vendidos</th>
                  <th>Ingresos</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let producto of productosPopulares; let i = index">
                  <td>
                    <div class="product-item">
                      <span class="rank">#{{ i + 1 }}</span>
                      {{ producto.nombre }}
                    </div>
                  </td>
                  <td class="font-bold">{{ producto.ventasCount }}</td>
                  <td class="amount">
                    {{ formatCurrency(producto.ingresos) }}
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <ng-template #noProductos>
            <div class="empty-state">
              <i class="icon-package"></i>
              <p>No hay datos de productos</p>
            </div>
          </ng-template>
        </div>
      </div>
    </div>

    <!-- Comments and Quotes Row -->
    <div class="tables-row">
      <!-- Comentarios Recientes -->
      <div class="card table-card">
        <div class="card-header">
          <h3 class="card-title">Comentarios Recientes</h3>
        </div>
        <div class="card-body">
          <div
            class="comments-list"
            *ngIf="comentariosRecientes.length > 0; else noComentarios"
          >
            <div
              *ngFor="let comentario of comentariosRecientes"
              class="comment-item"
            >
              <div class="comment-header">
                <span class="comment-user">{{ comentario.nombreUsuario }}</span>
                <div class="comment-rating">
                  <span
                    *ngFor="let star of [1,2,3,4,5]"
                    class="star"
                    [class.filled]="star <= comentario.calificacion"
                    >★</span
                  >
                </div>
                <span class="comment-date"
                  >{{ comentario.fecha | date:'dd/MM/yyyy' }}</span
                >
              </div>
              <p class="comment-text">{{ comentario.comentario }}</p>
              <small class="comment-product"
                >Producto: {{ comentario.producto }}</small
              >
            </div>
          </div>
          <ng-template #noComentarios>
            <div class="empty-state">
              <i class="icon-message-square"></i>
              <p>No hay comentarios recientes</p>
            </div>
          </ng-template>
        </div>
      </div>

      <!-- Cotizaciones Pendientes -->
      <div class="card table-card">
        <div class="card-header">
          <h3 class="card-title">Cotizaciones Pendientes</h3>
        </div>
        <div class="card-body">
          <div
            class="table-container"
            *ngIf="cotizacionesPendientes.length > 0; else noCotizaciones"
          >
            <table class="data-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Cliente</th>
                  <th>Fecha</th>
                  <th>Estado</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let cotizacion of cotizacionesPendientes">
                  <td class="font-bold">#{{ cotizacion.id }}</td>
                  <td>{{ cotizacion.nombre }}</td>
                  <td>{{ cotizacion.fechaSolicitud | date:'dd/MM/yyyy' }}</td>
                  <td>
                    <span class="status-badge warning"
                      >{{ cotizacion.estado }}</span
                    >
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <ng-template #noCotizaciones>
            <div class="empty-state">
              <i class="icon-file-text"></i>
              <p>No hay cotizaciones pendientes</p>
            </div>
          </ng-template>
        </div>
      </div>
    </div>
  </div>
</div>
